<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Snake </title>
  <style>
    :root{
      --bg:#0f1720;
      --panel:#0b1220;
      --snake:#66ff66;
      --food:#ff5b5b;
      --text:#e6eef8;
      --muted:#98a0b3;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#07101a);color:var(--text);font-family:Inter,Segoe UI,Roboto,'Helvetica Neue',Arial}
    .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}
    .game {
      background:linear-gradient(180deg,var(--panel),#071019);
      border-radius:12px;
      padding:16px;
      box-shadow:0 10px 30px rgba(2,6,23,0.6);
      display:flex;
      gap:16px;
      align-items:flex-start;
      max-width:100%;
    }
    canvas{background:#02060a;border-radius:8px;display:block}
    .sidebar{display:flex;flex-direction:column;gap:10px;min-width:200px}
    .score { font-size:18px; font-weight:600; color:var(--text) }
    .meta { color:var(--muted); font-size:13px }
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button.btn {
      background:#0b1220;border:1px solid rgba(255,255,255,0.03);color:var(--text);
      padding:8px 12px;border-radius:8px;font-weight:600;cursor:pointer;
    }
    button.btn:active{transform:translateY(1px)}
    .touch-pad{display:none;gap:8px;flex-direction:column;align-items:center;margin-top:10px}
    .row{display:flex;gap:8px}
    .pad-btn{width:56px;height:56px;border-radius:10px;background:#06111b;border:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--text);font-size:20px;user-select:none}
    @media (max-width:700px){
      .game{flex-direction:column;align-items:center}
      .sidebar{min-width:unset;width:100%;align-items:center}
      .touch-pad{display:flex}
    }
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:8px 0 18px;text-align:center">Snake — Browser Edition</h1>
    <div class="game" role="application" aria-label="Snake game">
      <canvas id="board" width="600" height="400"></canvas>

      <div class="sidebar">
        <div class="score" id="score">Score: 0</div>
        <div class="meta" id="best">Best: 0</div>

        <div style="height:8px"></div>

        <div class="controls">
          <button class="btn" id="start">Start</button>
          <button class="btn" id="pause">Pause</button>
          <button class="btn" id="restart">Restart</button>
          <button class="btn" id="speed">Speed: Normal</button>
        </div>

        <div class="hint">Use <strong>arrow keys</strong> or <strong>WASD</strong>. On mobile use the pad below.</div>

        <div class="touch-pad" id="touchPad">
          <div class="row">
            <div></div>
            <div class="pad-btn" data-dir="up">▲</div>
            <div></div>
          </div>
          <div class="row">
            <div class="pad-btn" data-dir="left">◀</div>
            <div class="pad-btn" data-dir="down">▼</div>
            <div class="pad-btn" data-dir="right">▶</div>
          </div>
        </div>

        <div style="flex:1"></div>
        <div class="meta" style="text-align:center">Made for cross-platform play — just open <code>index.html</code></div>
      </div>
    </div>
  </div>

  <script>
    // Canvas and context
    const canvas = document.getElementById('board');
    const ctx = canvas.getContext('2d');

    // UI
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const startBtn = document.getElementById('start');
    const pauseBtn = document.getElementById('pause');
    const restartBtn = document.getElementById('restart');
    const speedBtn = document.getElementById('speed');
    const touchPad = document.getElementById('touchPad');

    // Settings
    const CELL = 20; // pixels
    const COLS = Math.floor(canvas.width / CELL);
    const ROWS = Math.floor(canvas.height / CELL);
    const colors = { bg:'#01060a', snake:'#66ff66', food:'#ff5b5b', grid:'#071318' };

    // Game state
    let snake, dir, nextDir, food, score, best=0;
    let running = false, paused=false;
    let tickInterval = 120; // ms
    let loopId = null;

    // Load best from storage
    try { best = parseInt(localStorage.getItem('snake_best')||'0') } catch(e){ best=0 }
    bestEl.textContent = 'Best: ' + best;

    function resetGame(){
      snake = [{x: Math.floor(COLS/2), y: Math.floor(ROWS/2)}];
      // start with length 4
      for(let i=1;i<4;i++) snake.push({x: snake[0].x - i, y: snake[0].y});
      dir = {x:1,y:0};
      nextDir = {x:1,y:0};
      spawnFood();
      score = 0;
      scoreEl.textContent = 'Score: 0';
    }

    function spawnFood(){
      let tries=0;
      while(true){
        tries++;
        const p = {x: rand(1,COLS-2), y: rand(1,ROWS-2)};
        if(!snake.some(s=>s.x===p.x && s.y===p.y)){ food = p; break; }
        if(tries>500) break;
      }
    }

    function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

    function draw(){
      // background
      ctx.fillStyle = colors.bg;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // grid (subtle)
      ctx.strokeStyle = colors.grid;
      ctx.lineWidth = 0.4;
      for(let x=0;x<=canvas.width;x+=CELL){
        ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
      }
      for(let y=0;y<=canvas.height;y+=CELL){
        ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
      }

      // food
      ctx.fillStyle = colors.food;
      rect(food.x, food.y);

      // snake
      ctx.fillStyle = colors.snake;
      for(let i=0;i<snake.length;i++){
        const s = snake[i];
        // head slightly brighter
        if(i===0){ ctx.fillStyle = '#b6ffd1'; rect(s.x,s.y); ctx.fillStyle = colors.snake; }
        else rect(s.x,s.y);
      }
    }

    function rect(cx, cy){
      ctx.fillRect(cx*CELL+2, cy*CELL+2, CELL-4, CELL-4);
    }

    function step(){
      if(paused) return;
      // direction change
      if((nextDir.x !== -dir.x || nextDir.y !== -dir.y) ) dir = nextDir;

      const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

      // wrap-around behavior? -> we choose collision with walls.
      if(head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS){
        gameOver(); return;
      }

      // self collision
      if(snake.some(s => s.x===head.x && s.y===head.y)){ gameOver(); return; }

      snake.unshift(head);

      // eat food?
      if(head.x === food.x && head.y === food.y){
        score += 1;
        scoreEl.textContent = 'Score: ' + score;
        spawnFood();
      } else {
        snake.pop();
      }

      draw();
    }

    function gameOver(){
      clearInterval(loopId);
      running = false;
      paused = false;
      // update best
      if(score > best){ best = score; try{localStorage.setItem('snake_best', best)}catch(e){}; bestEl.textContent = 'Best: ' + best; }
      // show game over overlay briefly
      flashMessage('Game Over — Score: ' + score + '  (Press Start)');
    }

    function flashMessage(txt, ms=1200){
      // simple overlay
      ctx.fillStyle = 'rgba(2,6,12,0.7)'; ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#fff'; ctx.font='20px Inter,Arial'; ctx.textAlign='center';
      ctx.fillText(txt, canvas.width/2, canvas.height/2);
      setTimeout(()=>{ draw(); }, ms);
    }

    // Controls
    window.addEventListener('keydown', e=>{
      const code = e.key.toLowerCase();
      if(code === 'arrowup' || code === 'w') setDir(0,-1);
      else if(code === 'arrowdown' || code === 's') setDir(0,1);
      else if(code === 'arrowleft' || code === 'a') setDir(-1,0);
      else if(code === 'arrowright' || code === 'd') setDir(1,0);
      else if(code === ' '){ togglePause(); }
    });

    // touch pad
    touchPad.addEventListener('click', e=>{
      const b = e.target.closest('.pad-btn');
      if(!b) return;
      const d = b.dataset.dir;
      if(d==='up') setDir(0,-1);
      if(d==='down') setDir(0,1);
      if(d==='left') setDir(-1,0);
      if(d==='right') setDir(1,0);
    });

    function setDir(x,y){ nextDir = {x,y}; }

    // Buttons
    startBtn.addEventListener('click', ()=>{
      if(!running){ start(); } else { flashMessage('Already running'); }
    });
    pauseBtn.addEventListener('click', togglePause);
    restartBtn.addEventListener('click', ()=>{
      stopLoop(); resetGame(); draw(); start();
    });
    speedBtn.addEventListener('click', ()=>{
      if(tickInterval === 120){ tickInterval = 85; speedBtn.textContent = 'Speed: Fast'; }
      else if(tickInterval === 85){ tickInterval = 55; speedBtn.textContent = 'Speed: Very Fast'; }
      else { tickInterval = 120; speedBtn.textContent = 'Speed: Normal'; }
      if(running){ stopLoop(); start(); }
    });

    function start(){
      if(running) return;
      running = true; paused = false;
      loopId = setInterval(step, tickInterval);
    }
    function stopLoop(){ if(loopId) clearInterval(loopId); loopId=null; running=false; }
    function togglePause(){
      if(!running) return;
      paused = !paused;
      flashMessage(paused ? 'Paused' : 'Resumed', 600);
    }

    // init
    resetGame(); draw();

    // auto-start on desktop for convenience
    if(window.innerWidth > 700){ start(); } else {
      // show touch pad on small screens
      touchPad.style.display = 'flex';
    }

    // resize handler: keep canvas same pixel size but center
    window.addEventListener('resize', ()=>{ /* no-op for now */ });

    // friendly touch: allow swipe to change direction on mobile
    let touchStart = null;
    canvas.addEventListener('touchstart', e=>{ touchStart = e.touches[0]; });
    canvas.addEventListener('touchend', e=>{
      if(!touchStart) return;
      const t = e.changedTouches[0];
      const dx = t.clientX - touchStart.clientX;
      const dy = t.clientY - touchStart.clientY;
      if(Math.abs(dx) > Math.abs(dy)){
        setDir(dx>0?1:-1, 0);
      } else {
        setDir(0, dy>0?1:-1);
      }
      touchStart = null;
    });
  </script>
</body>
</html>

